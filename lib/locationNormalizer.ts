import stringSimilarity from 'string-similarity'

const LOCATION_ALIASES: Record<string, string> = {
  // US
  'usa': 'United States',
  'us': 'United States',
  'america': 'United States',
  'u.s.': 'United States',
  'u.s.a.': 'United States',
  // UK
  'uk': 'United Kingdom',
  'u.k.': 'United Kingdom',
  'england': 'United Kingdom',
  // Pakistan
  'pk': 'Pakistan',
  // UAE
  'uae': 'United Arab Emirates',
  'emirates': 'United Arab Emirates',
  // Saudi Arabia
  'saudi': 'Saudi Arabia',
  'ksa': 'Saudi Arabia',
  // Add more as needed...
}

const COUNTRIES = [
  'United States',
  'United Kingdom',
  'Pakistan',
  'India',
  'United Arab Emirates',
  'Saudi Arabia',
  'Canada',
  'Australia',
  'Bangladesh',
  'Nigeria',
  'Egypt',
  'Lebanon',
  'Jordan',
  'Turkey',
  'Malaysia',
  'Indonesia',
  'Qatar',
  'Kuwait',
  'Bahrain',
  'Oman',
  'France',
  'Germany',
  'Netherlands',
  'Sweden',
  'Norway',
  'Denmark',
  'Finland',
  'Switzerland',
  'Austria',
  'Belgium',
  'Italy',
  'Spain',
  'Portugal',
  'Greece',
  'Poland',
  'Czech Republic',
  'Hungary',
  'Romania',
  'Bulgaria',
  'Croatia',
  'Serbia',
  'Bosnia and Herzegovina',
  'Albania',
  'Kosovo',
  'North Macedonia',
  'Montenegro',
  'Slovenia',
  'Slovakia',
  'Lithuania',
  'Latvia',
  'Estonia',
  'Iceland',
  'Ireland',
  'Luxembourg',
  'Malta',
  'Cyprus',
  'Iraq',
  'Iran',
  'Syria',
  'Yemen',
  'Afghanistan',
  'Tajikistan',
  'Uzbekistan',
  'Kyrgyzstan',
  'Kazakhstan',
  'Turkmenistan',
  'Azerbaijan',
  'Georgia',
  'Armenia',
  'Moldova',
  'Ukraine',
  'Belarus',
  'Russia',
  'China',
  'Japan',
  'South Korea',
  'North Korea',
  'Mongolia',
  'Vietnam',
  'Thailand',
  'Cambodia',
  'Laos',
  'Myanmar',
  'Philippines',
  'Singapore',
  'Brunei',
  'East Timor',
  'Papua New Guinea',
  'Fiji',
  'New Zealand',
  'Brazil',
  'Argentina',
  'Chile',
  'Peru',
  'Colombia',
  'Venezuela',
  'Ecuador',
  'Bolivia',
  'Paraguay',
  'Uruguay',
  'Guyana',
  'Suriname',
  'French Guiana',
  'Mexico',
  'Guatemala',
  'Belize',
  'El Salvador',
  'Honduras',
  'Nicaragua',
  'Costa Rica',
  'Panama',
  'Cuba',
  'Jamaica',
  'Haiti',
  'Dominican Republic',
  'Puerto Rico',
  'Trinidad and Tobago',
  'Barbados',
  'Grenada',
  'Saint Vincent and the Grenadines',
  'Saint Lucia',
  'Dominica',
  'Antigua and Barbuda',
  'Saint Kitts and Nevis',
  'South Africa',
  'Kenya',
  'Uganda',
  'Tanzania',
  'Ethiopia',
  'Somalia',
  'Djibouti',
  'Eritrea',
  'Sudan',
  'South Sudan',
  'Central African Republic',
  'Chad',
  'Cameroon',
  'Gabon',
  'Congo',
  'Democratic Republic of the Congo',
  'Angola',
  'Zambia',
  'Zimbabwe',
  'Botswana',
  'Namibia',
  'Mozambique',
  'Malawi',
  'Burundi',
  'Rwanda',
  'Comoros',
  'Madagascar',
  'Mauritius',
  'Seychelles',
  'Morocco',
  'Algeria',
  'Tunisia',
  'Libya',
  'Mauritania',
  'Mali',
  'Burkina Faso',
  'Niger',
  'Senegal',
  'Gambia',
  'Guinea-Bissau',
  'Guinea',
  'Sierra Leone',
  'Liberia',
  'Ivory Coast',
  'Ghana',
  'Togo',
  'Benin',
  'Equatorial Guinea',
  'São Tomé and Príncipe',
]

// Country coordinates (centers of countries)
const COUNTRY_COORDINATES: Record<string, [number, number]> = {
  'United States': [37.0902, -95.7129],
  'United Kingdom': [55.3781, -3.4360],
  'Pakistan': [30.3753, 69.3451],
  'India': [20.5937, 78.9629],
  'United Arab Emirates': [23.4241, 53.8478],
  'Saudi Arabia': [23.8859, 45.0792],
  'Canada': [56.1304, -106.3468],
  'Australia': [-25.2744, 133.7751],
  'Bangladesh': [23.685, 90.3563],
  'Nigeria': [9.082, 8.6753],
  'Egypt': [26.8206, 30.8025],
  'Lebanon': [33.8547, 35.8623],
  'Jordan': [30.5852, 36.2384],
  'Turkey': [38.9637, 35.2433],
  'Malaysia': [4.2105, 101.9758],
  'Indonesia': [-0.7893, 113.9213],
  'Qatar': [25.3548, 51.1839],
  'Kuwait': [29.3117, 47.4818],
  'Bahrain': [25.9304, 50.6378],
  'Oman': [21.4735, 55.9754],
  'France': [46.6034, 1.8883],
  'Germany': [51.1657, 10.4515],
  'Netherlands': [52.1326, 5.2913],
  'Sweden': [60.1282, 18.6435],
  'Norway': [60.472, 8.4689],
  'Denmark': [56.2639, 9.5018],
  'Finland': [61.9241, 25.7482],
  'Switzerland': [46.8182, 8.2275],
  'Austria': [47.5162, 14.5501],
  'Belgium': [50.8503, 4.3517],
  'Italy': [41.8719, 12.5674],
  'Spain': [40.4637, -3.7492],
  'Portugal': [39.3999, -8.2245],
  'Greece': [39.0742, 21.8243],
  'Poland': [51.9194, 19.1451],
  'Czech Republic': [49.8175, 15.473],
  'Hungary': [47.1625, 19.5033],
  'Romania': [45.9432, 24.9668],
  'Bulgaria': [42.7339, 25.4858],
  'Croatia': [45.1, 15.2],
  'Serbia': [44.0165, 21.0059],
  'Bosnia and Herzegovina': [43.9159, 17.6791],
  'Albania': [41.1533, 20.1683],
  'Kosovo': [42.6026, 20.903],
  'North Macedonia': [41.6086, 21.7453],
  'Montenegro': [42.7087, 19.3744],
  'Slovenia': [46.0569, 14.5058],
  'Slovakia': [48.669, 19.699],
  'Lithuania': [55.1694, 23.8813],
  'Latvia': [56.8796, 24.6032],
  'Estonia': [58.5953, 25.0136],
  'Iceland': [64.9631, -19.0208],
  'Ireland': [53.1424, -7.6921],
  'Luxembourg': [49.8153, 6.1296],
  'Malta': [35.9375, 14.3754],
  'Cyprus': [35.1264, 33.4299],
  'Iraq': [33.2232, 43.6793],
  'Iran': [32.4279, 53.688],
  'Syria': [34.8021, 38.9968],
  'Yemen': [15.5527, 48.5164],
  'Afghanistan': [33.9391, 67.71],
  'Tajikistan': [38.5358, 71.0965],
  'Uzbekistan': [41.3775, 64.5853],
  'Kyrgyzstan': [41.2044, 74.7661],
  'Kazakhstan': [48.0196, 66.9237],
  'Turkmenistan': [38.9697, 59.5563],
  'Azerbaijan': [40.1431, 47.5769],
  'Georgia': [42.3154, 43.3569],
  'Armenia': [40.0691, 45.0382],
  'Moldova': [47.4116, 28.3699],
  'Ukraine': [48.3794, 31.1656],
  'Belarus': [53.7098, 27.9534],
  'Russia': [61.524, 105.3188],
  'China': [35.8617, 104.1954],
  'Japan': [36.2048, 138.2529],
  'South Korea': [35.9078, 127.7669],
  'North Korea': [40.3399, 127.5101],
  'Mongolia': [46.8625, 103.8467],
  'Vietnam': [14.0583, 108.2772],
  'Thailand': [15.870, 100.9925],
  'Cambodia': [12.5657, 104.991],
  'Laos': [19.8563, 102.4955],
  'Myanmar': [21.9162, 95.956],
  'Philippines': [12.8797, 121.774],
  'Singapore': [1.3521, 103.8198],
  'Brunei': [4.5353, 114.7277],
  'East Timor': [-8.8742, 125.7275],
  'Papua New Guinea': [-6.315, 143.9555],
  'Fiji': [-17.7134, 178.065],
  'New Zealand': [-40.9006, 174.886],
  'Brazil': [-14.235, -51.9253],
  'Argentina': [-38.4161, -63.6167],
  'Chile': [-35.6751, -71.543],
  'Peru': [-9.19, -75.0152],
  'Colombia': [4.5709, -74.2973],
  'Venezuela': [6.4238, -66.5897],
  'Ecuador': [-1.8312, -78.1834],
  'Bolivia': [-16.2902, -63.5887],
  'Paraguay': [-23.4425, -58.4438],
  'Uruguay': [-32.5228, -55.7658],
  'Guyana': [4.8604, -58.9302],
  'Suriname': [3.9193, -56.0278],
  'French Guiana': [3.9339, -53.1258],
  'Mexico': [23.6345, -102.5528],
  'Guatemala': [15.7835, -90.2308],
  'Belize': [17.1899, -88.4976],
  'El Salvador': [13.7942, -88.8965],
  'Honduras': [15.1999, -86.2419],
  'Nicaragua': [12.8654, -85.2072],
  'Costa Rica': [9.9281, -84.0907],
  'Panama': [8.538, -80.7821],
  'Cuba': [21.5218, -77.7812],
  'Jamaica': [18.1096, -77.2975],
  'Haiti': [18.9712, -72.2852],
  'Dominican Republic': [18.7357, -70.1627],
  'Puerto Rico': [18.2208, -66.5901],
  'Trinidad and Tobago': [10.6918, -61.2225],
  'Barbados': [13.1939, -59.5432],
  'Grenada': [12.2628, -61.6042],
  'Saint Vincent and the Grenadines': [12.9843, -61.2872],
  'Saint Lucia': [13.9094, -60.9789],
  'Dominica': [15.415, -61.371],
  'Antigua and Barbuda': [17.0608, -61.7964],
  'Saint Kitts and Nevis': [17.3578, -62.783],
  'South Africa': [-30.5595, 22.9375],
  'Kenya': [-0.0236, 37.9062],
  'Uganda': [1.3733, 32.2903],
  'Tanzania': [-6.369, 34.8888],
  'Ethiopia': [9.145, 40.4897],
  'Somalia': [5.1521, 46.1996],
  'Djibouti': [11.8251, 42.5903],
  'Eritrea': [15.1794, 39.7823],
  'Sudan': [12.8628, 30.2176],
  'South Sudan': [6.877, 31.307],
  'Central African Republic': [6.6111, 20.9394],
  'Chad': [15.4542, 18.7322],
  'Cameroon': [7.3697, 12.3547],
  'Gabon': [-0.8037, 11.6094],
  'Congo': [-0.228, 15.8277],
  'Democratic Republic of the Congo': [-4.0383, 21.7587],
  'Angola': [-11.2027, 17.8739],
  'Zambia': [-13.1339, 27.8493],
  'Zimbabwe': [-19.0154, 29.1549],
  'Botswana': [-22.3285, 24.6849],
  'Namibia': [-22.9576, 18.4904],
  'Mozambique': [-18.6657, 35.5296],
  'Malawi': [-13.2543, 34.3015],
  'Burundi': [-3.3731, 29.9189],
  'Rwanda': [-1.9403, 29.8739],
  'Comoros': [-11.6455, 43.3333],
  'Madagascar': [-18.7669, 46.8691],
  'Mauritius': [-20.3484, 57.5522],
  'Seychelles': [-4.6796, 55.492],
  'Morocco': [31.7917, -7.0926],
  'Algeria': [28.0339, 1.6596],
  'Tunisia': [33.8869, 9.5375],
  'Libya': [26.3351, 17.2283],
  'Mauritania': [21.0079, -10.9408],
  'Mali': [17.5707, -3.9962],
  'Burkina Faso': [12.2383, -1.5616],
  'Niger': [17.6078, 8.0817],
  'Senegal': [14.4974, -14.4524],
  'Gambia': [13.4432, -15.3101],
  'Guinea-Bissau': [11.8037, -15.1804],
  'Guinea': [9.9456, -9.6966],
  'Sierra Leone': [8.4606, -11.7799],
  'Liberia': [6.4281, -9.4295],
  'Ivory Coast': [7.54, -5.5471],
  'Ghana': [7.9465, -1.0232],
  'Togo': [8.6195, 0.8248],
  'Benin': [9.3077, 2.3158],
  'Equatorial Guinea': [1.6508, 10.2679],
  'São Tomé and Príncipe': [0.1864, 6.6131],
}

export async function normalizeLocation(input: string): Promise<{ canonical: string, latlng: [number, number] | null }> {
  const cleaned = input.trim().toLowerCase().replace(/[.,]/g, '')
  
  // 1. Alias dictionary
  if (LOCATION_ALIASES[cleaned]) {
    const canonical = LOCATION_ALIASES[cleaned]
    return { canonical, latlng: COUNTRY_COORDINATES[canonical] || null }
  }
  
  // 2. Fuzzy match against countries only
  const matchResult = stringSimilarity.findBestMatch(cleaned, COUNTRIES.map(c => c.toLowerCase()))
  if (matchResult.bestMatch.rating > 0.7) {
    const canonical = COUNTRIES[matchResult.bestMatchIndex]
    return { canonical, latlng: COUNTRY_COORDINATES[canonical] || null }
  }
  
  // 3. If no match found, return null (invalid country)
  return {
    canonical: '',
    latlng: null
  }
}

// Export the countries list for use in forms
export { COUNTRIES, COUNTRY_COORDINATES } 